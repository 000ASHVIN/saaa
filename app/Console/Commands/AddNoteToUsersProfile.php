<?php

namespace App\Console\Commands;

use App\Billing\Invoice;
use App\Note;
use Carbon\Carbon;
use Illuminate\Console\Command;

class AddNoteToUsersProfile extends Command
{
    /**
     * The name and signature of the console command.
     *
     * @var string
     */
    protected $signature = 'custom:notes';

    /**
     * The console command description.
     *
     * @var string
     */
    protected $description = 'This command will create a note on each of the following accounts.';

    /**
     * Create a new command instance.
     *
     * @return void
     */
    public function __construct()
    {
        parent::__construct();
    }

    /**
     * Execute the console command.
     *
     * @return mixed
     */
    public function handle()
    {
        $list = [
            '036113',
            '034247',
            '032808',
            '036255',
            '034356',
            '032922',
            '037751',
            '035820',
            '036070',
            '034748',
            '036276',
            '034379',
            '032948',
            '036277',
            '034380',
            '032949',
            '036288',
            '034391',
            '032960',
            '036290',
            '034395',
            '032965',
            '037489',
            '035194',
            '034005',
            '035847',
            '034178',
            '035084',
            '036625',
            '034559',
            '035539',
            '035570',
            '037173',
            '031628',
            '035899',
            '035926',
            '036354',
            '034473',
            '033473',
            '033109',
            '036679',
            '034589',
            '033303',
            '032156',
            '031401',
            '035395',
            '033994',
            '030926',
            '037754',
            '035823',
            '034157',
            '032276',
            '035562',
            '035795',
            '029085',
            '036180',
            '034287',
            '032852',
            '037322',
            '038476',
            '037508',
            '035211',
            '034022',
            '032059',
            '036503',
            '033890',
            '035075',
            '035462',
            '036633',
            '034568',
            '033281',
            '031341',
            '037388',
            '037463',
            '037010',
            '034767',
            '033570',
            '031653',
            '029742',
            '036773',
            '034680',
            '033428',
            '031519',
            '036880',
            '034704',
            '030088',
            '037246',
            '035087',
            '033872',
            '037505',
            '035208',
            '034019',
            '032075',
            '026821',
            '037300',
            '035149',
            '033910',
            '032002',
            '037302',
            '035151',
            '033912',
            '032004',
            '037500',
            '035203',
            '034014',
            '032070',
            '037502',
            '035206',
            '034017',
            '037696',
            '035686',
            '034130',
            '032251',
            '037697',
            '035687',
            '034131',
            '032252',
            '035987',
            '034187',
            '032445',
            '030362',
            '036339',
            '034447',
            '033236',
            '033017',
            '036328',
            '034436',
            '033006',
            '031529',
            '037442',
            '037611',
            '035368',
            '032200',
            '036507',
            '033514',
            '035831',
            '036952',
            '034733',
            '033537',
            '031623',
            '037252',
            '034777',
            '035645',
            '036337',
            '034445',
            '033015',
            '029596',
            '035268',
            '036948',
            '032213',
            '032094',
            '037183',
            '037184',
            '034967',
            '033771',
            '031897',
            '028108',
            '036338',
            '034446',
            '033016',
            '036545',
            '035630',
            '036707',
            '034615',
            '033327',
            '027786',
            '027785',
            '034026',
            '028118',
            '028127',
            '030167',
            '037306',
            '035181',
            '033967',
            '037753',
            '035822',
            '034156',
            '032275',
            '036990',
            '029447',
            '029510',
            '036783',
            '034652',
            '033384',
            '031503',
            '035998',
            '031278',
            '031277',
            '031276',
            '031182',
            '031181',
            '031180',
            '031184',
            '031183',
            '031416',
            '031670',
            '037013',
            '034772',
            '033575',
            '031681',
            '037014',
            '034773',
            '033576',
            '031682',
            '032088',
            '036550',
            '037620',
            '035376',
            '034094',
            '032212',
            '034032',
            '036058',
            '032527',
            '033990',
            '033020',
            '033441',
            '033453',
            '034033',
            '037362',
            '036854',
            '034511',
            '036688',
            '036791',
            '034622',
            '036961',
            '037387',
            '035123',
            '035125',
            '035126',
            '035221',
            '035299',
            '037629',
            '035470',
            '035580',
            '035738',
            '036835',
            '035754',
            '036966',
            '035909',
            '035908',
            '036722',
            '036007',
            '036158',
            '036376',
            '037258',
            '036669',
            '036797',
            '036798',
            '037024',
            '037319',
            '037390',
            '037578',
            '037683'
        ];

        $invoices = Invoice::with('user')->whereIn('reference', $list)->get();
        $uniqueUsers = $invoices->unique('user_id');

        $this->info("We have ".count($uniqueUsers)." Users");

        foreach ($uniqueUsers as $invoice){
            $note = new Note([
                'type' => 'general',
                'description' => 'I have sent the account statement to the client',
                'logged_by' => 'Michelle Erasmus',
                'created_at' => Carbon::parse('23 March 2018'),
                'updated_at' => Carbon::parse('23 March 2018'),
            ]);

            $this->info('Saving note for '.$invoice->user->email);
            $invoice->user->notes()->save($note);
        }
    }
}

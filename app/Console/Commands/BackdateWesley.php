<?php

namespace App\Console\Commands;

use App\Billing\Invoice;
use App\Note;
use App\Users\User;
use Illuminate\Console\Command;
use Mockery\Exception;

class BackdateWesley extends Command
{
    /**
     * The name and signature of the console command.
     *
     * @var string
     */
    protected $signature = 'backdate:wesley';

    /**
     * The console command description.
     *
     * @var string
     */
    protected $description = 'This command will backdate user notes for sales';

    /**
     * Create a new command instance.
     *
     * @return void
     */
    public function __construct()
    {
        parent::__construct();
    }

    /**
     * Execute the console command.
     *
     * @return mixed
     */
    public function handle()
    {
        $list = [
            '06644',
            '06687',
            '07527',
            '07922',
            '09046',
            '09365',
            '010100',
            '010103',
            '010106',
            '010205',
            '010267',
            '010270',
            '010276',
            '010278',
            '010283',
            '010402',
            '010479',
            '010493',
            '010560',
            '010561',
            '010564',
            '010566',
            '010567',
            '010598',
            '010615',
            '010616',
            '010632',
            '010649',
            '010667',
            '010672',
            '010674',
            '010686',
            '010705',
            '010732',
            '010740',
            '010743',
            '010757',
            '010769',
            '010786',
            '010797',
            '010809',
            '010821',
            '010824',
            '010834',
            '010841',
            '010857',
            '010859',
            '010871',
            '010934',
            '010937',
            '010960',
            '010963',
            '011048',
            '011221',
            '011264',
            '011418',
            '011556',
            '012093',
            '012098',
            '012595',
            '012948',
            '012986',
            '012988',
            '012993',
            '012995',
            '013000',
            '013148',
            '013157',
            '013252',
            '013254',
            '013256',
            '013257',
            '013266',
            '013279',
            '013280',
            '013281',
            '013282',
            '013384',
            '013388',
            '013391',
            '013393',
            '013395',
            '013402',
            '013405',
            '013466',
            '013470',
            '013473',
            '013505',
            '013508',
            '013513',
            '013522',
            '013524',
            '013530',
            '013540',
            '013597',
            '013603',
            '013605',
            '013607',
            '013608',
            '013609',
            '013616',
            '013647',
            '013654',
            '013659',
            '013661',
            '013663',
            '013701',
            '013704',
            '013709',
            '014108',
            '014402',
            '014413',
            '014428',
            '014460',
            '014468',
            '014488',
            '014492',
            '014534',
            '014590',
            '014592',
            '014607',
            '014628',
            '014629',
            '014711',
            '014716',
            '014737',
            '014764',
            '014791',
            '014807',
            '014820',
            '014834',
            '014836',
            '014838',
            '014964',
            '014967',
            '014969',
            '015047',
            '015062',
            '015066',
            '015073',
            '015093',
            '015095',
            '015188',
            '015190',
            '015194',
            '015196',
            '015201',
            '015283',
            '015338',
            '015345',
            '015367',
            '015380',
            '015383',
            '015386',
            '015391',
            '015392',
            '015398',
            '015460',
            '015462',
            '015464',
            '015465',
            '015469',
            '015486',
            '015487',
            '015488',
            '015489',
            '015494',
            '015500',
            '015504',
            '015505',
            '015510',
            '015520',
            '015529',
            '015534',
            '015537',
            '015541',
            '015654',
            '015655',
            '015658',
            '015659',
            '015660',
            '015661',
            '015666',
            '015668',
            '015673',
            '015676',
            '015691',
            '015693',
            '015698',
            '015704',
            '015713',
            '015714',
            '015715',
            '015717',
            '015728',
            '015729',
            '015732',
            '015749',
            '015753',
            '015756',
            '015769',
            '015778',
            '015781',
            '015786',
            '015790',
            '015793',
            '015795',
            '015853',
            '015856',
            '015857',
            '015858',
            '015912',
            '015923',
            '015925',
            '015930',
            '015933',
            '015937',
            '015940',
            '015960',
            '015963',
            '015974',
            '016002',
            '016348',
            '016629',
            '016640',
            '016641',
            '016643',
            '016645',
            '016646',
            '016647',
            '016648',
            '016651',
            '016652',
            '016653',
            '016654',
            '016655',
            '016668',
            '016678',
            '016684',
            '016685',
            '016690',
            '016692',
            '016696',
            '016703',
            '016705',
            '016743',
            '016744',
            '016746',
            '016748',
            '016749',
            '016753',
            '016754',
            '016759',
            '016784',
            '016785',
            '016793',
            '016820',
            '016834',
            '016837',
            '016840',
            '016848',
            '016849',
            '016850',
            '016851',
            '016853',
            '016858',
            '016867',
            '016871',
            '016874',
            '016876',
            '016877',
            '016878',
            '016879',
            '016880',
            '016881',
            '016890',
            '016897',
            '016898',
            '016901',
            '016921',
            '016922',
            '016925',
            '016926',
            '016962',
            '016964',
            '016965',
            '016967',
            '016971',
            '016973',
            '016977',
            '016990',
            '017004',
            '017006',
            '017009',
            '017010',
            '017011',
            '017012',
            '017022',
            '017042',
            '017043',
            '017061',
            '017067',
            '017069',
            '017077',
            '017081',
            '017082',
            '017132',
            '017136',
            '017148',
            '017153',
            '017155',
            '017158',
            '017168',
            '017183',
            '017188',
            '017191',
            '017196',
            '017197',
            '017201',
            '017203',
            '017206',
            '017207',
            '017210',
            '017211',
            '017237',
            '017240',
            '017248',
            '017251',
            '017253',
            '017355',
            '017357',
            '017361',
            '017363',
            '017368',
            '017447',
            '017501',
            '017509',
            '017510',
            '017512',
            '017516',
            '017518',
            '017527',
            '017529',
            '017580',
            '017582',
            '017584',
            '017585',
            '017593',
            '017607',
            '017608',
            '017611',
            '017612',
            '017617',
            '017619',
            '017654',
            '017663',
            '017664',
            '017666',
            '017680',
            '017685',
            '017688',
            '017693',
            '017697',
            '017709',
            '017710',
            '017711',
            '017712',
            '017717',
            '017720',
            '017724',
            '017732',
            '017735',
            '017781',
            '017783',
            '017785',
            '017790',
            '017801',
            '017805',
            '017808',
            '017813',
            '017815',
            '017818',
            '017823',
            '017828',
            '017831',
            '017839',
            '017847',
            '017852',
            '017858',
            '017876',
            '017878',
            '017880',
            '017886',
            '017895',
            '017896',
            '017909',
            '017932',
            '017940',
            '017966',
            '017968',
            '017969',
            '017970',
            '017975',
            '017988',
            '017996',
            '018011',
            '018013',
            '018016',
            '018021',
            '018038',
            '018041',
            '018108',
            '018414',
            '018421',
            '018581',
            '018709',
            '018738',
            '018758',
            '018765',
            '018766',
            '018769',
            '018776',
            '018797',
            '018798',
            '018801',
            '018802',
            '018961',
            '018991',
            '019080',
            '019084',
            '019086',
            '019099',
            '019104',
            '019125',
            '019186',
            '019189',
            '019191',
            '019344',
            '019379',
            '019381',
            '019385',
            '019387',
            '019392',
            '019471',
            '019524',
            '019540',
            '019543',
            '019742',
            '019744',
            '019746',
            '019747',
            '019791',
            '019818',
            '019822',
            '019852',
            '019853',
            '019854',
            '019855',
            '019860',
            '019937',
            '019939',
            '019944',
            '019995',
            '019999',
            '020002',
            '020007',
            '020048',
            '020051',
            '020056',
            '020061',
            '020110',
            '020112',
            '020118',
            '020178',
            '020191',
            '020193',
            '020194',
            '020195',
            '020226',
            '020232',
            '020234',
            '020237',
            '020242',
            '020263',
            '020268',
            '020284',
            '020286',
            '020289',
            '020290',
            '020308',
            '020318',
            '020321',
            '020327',
            '020331',
            '020334',
            '020339',
            '020385',
            '020679',
            '020685',
            '020842',
            '020931',
            '020951',
            '020960',
            '020961',
            '020962',
            '020994',
            '021006',
            '021027',
            '021028',
            '021039',
            '021061',
            '021062',
            '021067',
            '021068',
            '021073',
            '021086',
            '021087',
            '021092',
            '021108',
            '021119',
            '021120',
            '021123',
            '021144',
            '021148',
            '021149',
            '021150',
            '021154',
            '021155',
            '021185',
            '021186',
            '021187',
            '021188',
            '021193',
            '021200',
            '021201',
            '021204',
            '021211',
            '021217',
            '021228',
            '021249',
            '021250',
            '021252',
            '021253',
            '021256',
            '021259',
            '021264',
            '021269',
            '021271',
            '021300',
            '021316',
            '021329',
            '021348',
            '021349',
            '021350',
            '021399',
            '021426',
            '021445',
            '021463',
            '021519',
            '021523',
            '021525',
            '021531',
            '021537',
            '021540',
            '021574',
            '021578',
            '021581',
            '021583',
            '021595',
            '021596',
            '021599',
            '021616',
            '021633',
            '021638',
            '021666',
            '021671',
            '021673',
            '021676',
            '021677',
            '021689',
            '021690',
            '021734',
            '021749',
            '021753',
            '021757',
            '021760',
            '021778',
            '021786',
            '021812',
            '021815',
            '021817',
            '021845',
            '021846',
            '021857',
            '021945',
            '021980',
            '021982',
            '021986',
            '021988',
            '021993',
            '022072',
            '022125',
            '022186',
            '022188',
            '022190',
            '022191',
            '022197',
            '022216',
            '022220',
            '022221',
            '022223',
            '022227',
            '022228',
            '022234',
            '022236',
            '022238',
            '022244',
            '022284',
            '022378',
            '022391',
            '022392',
            '022393',
            '022394',
            '022399',
            '022402',
            '022420',
            '022421',
            '022423',
            '022428',
            '022439',
            '022446',
            '022457',
            '022460',
            '022499',
            '022500',
            '022501',
            '022504',
            '022523',
            '022531',
            '022535',
            '022542',
            '022548',
            '022551',
            '022554',
            '022555',
            '022559',
            '022561',
            '022594',
            '022595',
            '022609',
            '022613',
            '022616',
            '022637',
            '022639',
            '022644',
            '022661',
            '022665',
            '022668',
            '022673',
            '022677',
            '022680',
            '022685',
            '022689',
            '022698',
            '022701',
            '022703',
            '022709',
            '022716',
            '022717',
            '022738',
            '022746',
            '022751',
            '022773',
            '022783',
            '022788',
            '022789',
            '022790',
            '022799',
            '022835',
            '022836',
            '022837',
            '022845',
            '022847',
            '022869',
            '022870',
            '022879',
            '022881',
            '022884',
            '022885',
            '022910',
            '022911',
            '022919',
            '022924',
            '022926',
            '022930',
            '022931',
            '022932',
            '022957',
            '022959',
            '022961',
            '022966',
            '022978',
            '022979',
            '022983',
            '022984',
            '022987',
            '022988',
            '023018',
            '023035',
            '023143',
            '023145',
            '023195',
            '023233',
            '023243',
            '023245',
            '023246',
            '023247',
            '023254',
            '023258',
            '023262',
            '023265',
            '023266',
            '023272',
            '023274',
            '023276',
            '023281',
            '023282',
            '023286',
            '023287',
            '023295',
            '023322',
            '023345',
            '023356',
            '023374',
            '023375',
            '023380',
            '023383',
            '023386',
            '023388',
            '023392',
            '023422',
            '023451',
            '023455',
            '023483',
            '023490',
            '023491',
            '023494',
            '023498',
            '023517',
            '023520',
            '023521',
            '023526',
            '023530',
            '023531',
            '023532',
            '023533',
            '023534',
            '023552',
            '023778',
            '023836',
            '023840',
            '023842',
            '023845',
            '023852',
            '023865',
            '023869',
            '023870',
            '023873',
            '023877',
            '023906',
            '023911',
            '023924',
            '023938',
            '023957',
            '023971',
            '023974',
            '023976',
            '024040',
            '024072',
            '024074',
            '024078',
            '024080',
            '024083',
            '024151',
            '024194',
            '024210',
            '024212',
            '024220',
            '024227',
            '024228',
            '024271',
            '024273',
            '024275',
            '024276',
            '024282',
            '024283',
            '024285',
            '024287',
            '024288',
            '024290',
            '024291',
            '024301',
            '024304',
            '024305',
            '024310',
            '024342',
            '024583',
            '024587',
            '024680',
            '024699',
            '024703',
            '024708',
            '024716',
            '024720',
            '024752',
            '024807',
            '024808',
            '024809',
            '024810',
            '024815',
            '024818',
            '024822',
            '024827',
            '024855',
            '024857',
            '024862',
            '024865',
            '024866',
            '024869',
            '024917',
            '024944',
            '024948',
            '024950',
            '024952',
            '024956',
            '024989',
            '024991',
            '024996',
            '025017',
            '025021',
            '025024',
            '025028',
            '025038',
            '025059',
            '025062',
            '025067',
            '025071',
            '025078',
            '025079',
            '025080',
            '025081',
            '025083',
            '025102',
            '025103',
            '025104',
            '025118',
            '025119',
            '025121',
            '025126',
            '025129',
            '025133',
            '025135',
            '025136',
            '025151',
            '025160',
            '025176',
            '025179',
            '025188',
            '025190',
            '025193',
            '025212',
            '025239',
            '025249',
            '025331',
            '025333',
            '025335',
            '025351',
            '025359',
            '025363',
            '025388',
            '025398',
            '025411',
            '025412',
            '025416',
            '025425',
            '025433',
            '025443',
            '025468',
            '025574',
            '025624',
            '025700',
            '025702',
            '025727',
            '025742',
            '025761',
            '025763',
            '025803',
            '025807',
            '025812',
            '025858',
            '025864',
            '025923',
            '025939',
            '025948',
            '025952',
            '025964',
            '025976',
            '025983',
            '025984',
            '025987',
            '025991',
            '025993',
            '025995',
            '025996',
            '026000',
            '026001',
            '026002',
            '026004',
            '026006',
            '026013',
            '026037',
            '026038',
            '026099',
            '026130',
            '026210',
            '026214',
            '026232',
            '026237',
            '026245',
            '026270',
            '026301',
            '026302',
            '026303',
            '026304',
            '026306',
            '026307',
            '026308',
            '026309',
            '026310',
            '026311',
            '026330',
            '026335',
            '026425',
            '026459',
            '026463',
            '026465',
            '026468',
            '026535',
            '026578',
            '026605',
            '026655',
            '026715',
            '026719',
            '026720',
            '026726',
            '026751',
            '026755',
            '026769',
            '026770',
            '026771',
            '026772',
            '026777',
            '026780',
            '026782',
            '026884',
            '026888',
            '026895',
            '026935',
            '026937',
            '026942',
            '026988',
            '026992',
            '026995',
            '027035',
            '027038',
            '027043',
            '027047',
            '027085',
            '027087',
            '027092',
            '027095',
            '027105',
            '027123',
            '027125',
            '027151',
            '027168',
            '027170',
            '027172',
            '027177',
            '027188',
            '027231',
            '027310',
            '027414',
            '027416',
            '027463',
            '027507',
            '027524',
            '027529',
            '027676',
            '027683',
            '027686',
            '027690',
            '027719',
            '027720',
            '027742',
            '028019',
            '028041',
            '028045',
            '028099',
            '028104',
            '028140',
            '028163',
            '028167',
            '028231',
            '028262',
            '028264',
            '028270',
            '028273',
            '028338',
            '028378',
            '028426',
            '028429',
            '028430',
            '028436',
            '028464',
            '028468',
            '028520',
            '028521',
            '028522',
            '028523',
            '028528',
            '028531',
            '028533',
            '028581',
            '028646',
            '028692',
            '028694',
            '028699',
            '028716',
            '028719',
            '028745',
            '028748',
            '028753',
            '028757',
            '028806',
            '028808',
            '028813',
            '028815',
            '028875',
            '028917',
            '028919',
            '028968',
            '028970',
            '028972',
            '028976',
            '028986',
            '028995',
            '029014',
            '029049',
            '029090',
            '029096',
            '029101',
            '029192',
            '029241',
            '029458',
            '029464',
            '029465',
            '029468',
            '029472',
            '029502',
            '029503',
            '029561',
            '029643',
            '029647',
            '029663',
            '029664',
            '029665',
            '029666',
            '029680',
            '029685',
            '029704',
            '029726',
            '029730',
            '029826',
            '029857',
            '029859',
            '029863',
            '029865',
            '029868',
            '029925',
            '029965',
            '030017',
            '030020',
            '030021',
            '030027',
            '030048',
            '030052',
            '030057',
            '030115',
            '030116',
            '030117',
            '030118',
            '030123',
            '030126',
            '030128',
            '030232',
            '030246',
            '030248',
            '030253',
            '030344',
            '030347',
            '030453',
            '030461',
            '030465',
            '030550',
            '030552',
            '030557',
            '030559',
            '030570',
            '030612',
            '030692',
            '030693',
            '030726',
            '030728',
            '030732',
            '030777',
            '030798',
            '030800',
            '030807',
            '030808',
            '030809',
            '030813',
            '030820',
            '030836',
            '030837',
            '030838',
            '030839',
            '030841',
            '030842',
            '030880',
            '030881',
            '030882',
            '030883',
            '030886',
            '030923',
            '030924',
            '030954',
            '030968',
            '030969',
            '031077',
            '031079',
            '031125',
            '031151',
            '031246',
            '031249',
            '031250',
            '031256',
            '031262',
            '031263',
            '031266',
            '031269',
            '031276',
            '031277',
            '031278',
            '031294',
            '031336',
            '031338',
            '031339',
            '031404',
            '031512',
            '031516',
            '031536',
            '031548',
            '031553',
            '031613',
            '031744',
            '031775',
            '031777',
            '031783',
            '031786',
            '031882',
            '031956',
            '031966',
            '031980',
            '031993',
            '031994',
            '032000',
            '032074',
            '032127',
            '032128',
            '032133',
            '032135',
            '032140',
            '032188',
            '032191',
            '032219',
            '032227',
            '032231',
            '032242',
            '032244',
            '032263',
            '032380',
            '032381',
            '032470',
            '032471',
            '032476',
            '032484',
            '032573',
            '032578',
            '032593',
            '032594',
            '032602',
            '032613',
            '032617',
            '032623',
            '032643',
            '032654',
            '032656',
            '032666',
            '032670',
            '032675',
            '032695',
            '032698',
            '032700',
            '032703',
            '032712',
            '032714',
            '032720',
            '032725',
            '032730',
            '032736',
            '032758',
            '032806',
            '032840',
            '032927',
            '032973',
            '032998',
            '033039',
            '033110',
            '033128',
            '033129',
            '033197',
            '033199',
            '033200',
            '033201',
            '033202',
            '033204',
            '033211',
            '033217',
            '033218',
            '033221',
            '033232',
            '033233',
            '033234',
            '033235',
            '033250',
            '033251',
            '033276',
            '033279',
            '033306',
            '033328',
            '033329',
            '033333',
            '033334',
            '033385',
            '033403',
            '033421',
            '033425',
            '033434',
            '033435',
            '033447',
            '033448',
            '033449',
            '033452',
            '033487',
            '033491',
            '033498',
            '033500',
            '033505',
            '033506',
            '033507',
            '033527',
            '033560',
            '033631',
            '033658',
            '033659',
            '033665',
            '033667',
            '033718',
            '033800',
            '033809',
            '033818',
            '033849',
            '033871',
            '033908',
        ];

        // Wesley This is the agent who will be assigned.
        $agent = User::find('3469');
        $this->info("We are working with ".$agent->first_name." ".$agent->last_name);

        $invoices = Invoice::whereIn('reference', $list)
            ->whereDoesntHave('note')
            ->get();

        $this->info("We have ".count($invoices)." Invoices");

        try{
            $invoices->each(function ($invoice) use($agent){

                if ($invoice->type == 'subscription'){
                    $note = new Note([
                        'type' => 'subscription_upgrade_procedure',
                        'created_at' => $invoice->created_at,
                        'updated_at' => $invoice->updated_at,
                        'description' => "CPD subscription upgraded to ".$invoice->user->subscription('cpd')->plan->name." ".$invoice->user->subscription('cpd')->plan->interval."ly",
                        'logged_by' => $agent->first_name .' '.$agent->last_name,
                        'commision_claimed' => true
                    ]);

                    $note->invoice()->associate($invoice);
                    $invoice->user->notes()->save($note);
                    $this->info("We have just fixed ".$invoice->reference. " for ".$agent->first_name.' '.$agent->last_name);

                }elseif ($invoice->type == 'event'){
                    if ($invoice->ticket){
                        $note = new Note([
                            'type' => 'event_registration',
                            'created_at' => $invoice->created_at,
                            'updated_at' => $invoice->updated_at,
                            'description' => "I have registered ".$invoice->user->first_name." ".$invoice->user->last_name." for ".$invoice->ticket->event->name." at ". $invoice->ticket->venue->name,
                            'logged_by' => $agent->first_name .' '.$agent->last_name,
                            'commision_claimed' => true
                        ]);

                        $note->invoice()->associate($invoice);
                        $invoice->user->notes()->save($note);
                        $this->info("We have just fixed ".$invoice->reference. " for ".$agent->first_name.' '.$agent->last_name);
                    }

                }elseif($invoice->type == 'store'){
                    $note = new Note([
                        'type' => 'store_items',
                        'created_at' => $invoice->created_at,
                        'updated_at' => $invoice->updated_at,
                        'description' => "Store Item purchased for ".$invoice->user->first_name." ".$invoice->user->last_name,
                        'logged_by' => $agent->first_name .' '.$agent->last_name,
                        'commision_claimed' => true
                    ]);

                    $note->invoice()->associate($invoice);
                    $invoice->user->notes()->save($note);
                    $this->info("We have just fixed ".$invoice->reference. " for ".$agent->first_name.' '.$agent->last_name);
                }

            });
        }catch (\Exception $exception){
            request($exception);
        }
    }
}

<?php

namespace App\Console\Commands;

use App\Billing\Invoice;
use App\Note;
use App\Users\User;
use Illuminate\Console\Command;
use Mockery\Exception;

class BackdateJarrod extends Command
{
    /**
     * The name and signature of the console command.
     *
     * @var string
     */
    protected $signature = 'backdate:jarrod';

    /**
     * The console command description.
     *
     * @var string
     */
    protected $description = 'This command will backdate user notes for sales';

    /**
     * Create a new command instance.
     *
     * @return void
     */
    public function __construct()
    {
        parent::__construct();
    }

    /**
     * Execute the console command.
     *
     * @return mixed
     */
    public function handle()
    {
        $list = [
            '010101',
            '010112',
            '010226',
            '010227',
            '010468',
            '010562',
            '010684',
            '010717',
            '010737',
            '010742',
            '010785',
            '010802',
            '010808',
            '010825',
            '010827',
            '010839',
            '010851',
            '010931',
            '010978',
            '011014',
            '011046',
            '011050',
            '011180',
            '012021',
            '012089',
            '012094',
            '012227',
            '012736',
            '012963',
            '012964',
            '013105',
            '013140',
            '013253',
            '013305',
            '013398',
            '013410',
            '013418',
            '013504',
            '013511',
            '013512',
            '013525',
            '013528',
            '013595',
            '013646',
            '013655',
            '013664',
            '013669',
            '013715',
            '013771',
            '014240',
            '014385',
            '014393',
            '014401',
            '014403',
            '014452',
            '014461',
            '014496',
            '014510',
            '014576',
            '014611',
            '014792',
            '014835',
            '014960',
            '014965',
            '015004',
            '015015',
            '015091',
            '015166',
            '015167',
            '015330',
            '015361',
            '015371',
            '015375',
            '015384',
            '015385',
            '015461',
            '015499',
            '015502',
            '015514',
            '015531',
            '015577',
            '015578',
            '015586',
            '015590',
            '015637',
            '015643',
            '015646',
            '015650',
            '015653',
            '015667',
            '015670',
            '015675',
            '015696',
            '015699',
            '015706',
            '015708',
            '015716',
            '015726',
            '015777',
            '015785',
            '015796',
            '015799',
            '015874',
            '015875',
            '015877',
            '015879',
            '015885',
            '015892',
            '015893',
            '015894',
            '015895',
            '015896',
            '015898',
            '015908',
            '015914',
            '015915',
            '015920',
            '015921',
            '015922',
            '015968',
            '015973',
            '016025',
            '016426',
            '016630',
            '016681',
            '016873',
            '016875',
            '016882',
            '016894',
            '016899',
            '016900',
            '016914',
            '016984',
            '016986',
            '017008',
            '017013',
            '017014',
            '017041',
            '017091',
            '017092',
            '017106',
            '017185',
            '017193',
            '017195',
            '017200',
            '017238',
            '017245',
            '017249',
            '017333',
            '017334',
            '017456',
            '017461',
            '017493',
            '017513',
            '017534',
            '017588',
            '017592',
            '017598',
            '017601',
            '017626',
            '017665',
            '017672',
            '017713',
            '017733',
            '017773',
            '017791',
            '017814',
            '017822',
            '017859',
            '017881',
            '017884',
            '017891',
            '017906',
            '017911',
            '017946',
            '018010',
            '018017',
            '018023',
            '018024',
            '018048',
            '018065',
            '018068',
            '018128',
            '018496',
            '018700',
            '018708',
            '018710',
            '018714',
            '018745',
            '018767',
            '018768',
            '018770',
            '018790',
            '018917',
            '019018',
            '019023',
            '019049',
            '019058',
            '019059',
            '019060',
            '019101',
            '019123',
            '019168',
            '019183',
            '019187',
            '019205',
            '019228',
            '019237',
            '019263',
            '019267',
            '019269',
            '019288',
            '019357',
            '019358',
            '019480',
            '019485',
            '019516',
            '019537',
            '019539',
            '019568',
            '019646',
            '019761',
            '019772',
            '019784',
            '019795',
            '019856',
            '019891',
            '019895',
            '019896',
            '019897',
            '019906',
            '019915',
            '019918',
            '019928',
            '019929',
            '019945',
            '019962',
            '019963',
            '019970',
            '019971',
            '019974',
            '019976',
            '019980',
            '020009',
            '020012',
            '020043',
            '020044',
            '020047',
            '020055',
            '020066',
            '020113',
            '020116',
            '020231',
            '020238',
            '020244',
            '020245',
            '020332',
            '020333',
            '020335',
            '020405',
            '020758',
            '020952',
            '020955',
            '020956',
            '020985',
            '020993',
            '020995',
            '021005',
            '021007',
            '021016',
            '021045',
            '021162',
            '021164',
            '021165',
            '021166',
            '021168',
            '021171',
            '021174',
            '021202',
            '021203',
            '021205',
            '021212',
            '021216',
            '021219',
            '021242',
            '021257',
            '021263',
            '021266',
            '021272',
            '021297',
            '021345',
            '021414',
            '021418',
            '021511',
            '021512',
            '021533',
            '021541',
            '021576',
            '021580',
            '021588',
            '021591',
            '021597',
            '021601',
            '021635',
            '021687',
            '021705',
            '021720',
            '021747',
            '021762',
            '021763',
            '021764',
            '021782',
            '021809',
            '021813',
            '021818',
            '021828',
            '021829',
            '021831',
            '021832',
            '021833',
            '021835',
            '021843',
            '021844',
            '021853',
            '021858',
            '021863',
            '021958',
            '021959',
            '022081',
            '022086',
            '022117',
            '022141',
            '022224',
            '022229',
            '022232',
            '022239',
            '022241',
            '022243',
            '022290',
            '022385',
            '022395',
            '022406',
            '022407',
            '022412',
            '022419',
            '022447',
            '022461',
            '022483',
            '022493',
            '022503',
            '022505',
            '022522',
            '022524',
            '022528',
            '022540',
            '022546',
            '022562',
            '022581',
            '022589',
            '022596',
            '022598',
            '022606',
            '022607',
            '022608',
            '022611',
            '022614',
            '022645',
            '022676',
            '022684',
            '022699',
            '022704',
            '022707',
            '022739',
            '022741',
            '022745',
            '022749',
            '022781',
            '022782',
            '022784',
            '022798',
            '022842',
            '022848',
            '022872',
            '022877',
            '022950',
            '022951',
            '022952',
            '022956',
            '022962',
            '022968',
            '022969',
            '022980',
            '022985',
            '022986',
            '023046',
            '023163',
            '023224',
            '023234',
            '023261',
            '023296',
            '023303',
            '023352',
            '023361',
            '023371',
            '023373',
            '023379',
            '023382',
            '023390',
            '023394',
            '023397',
            '023404',
            '023411',
            '023424',
            '023425',
            '023436',
            '023438',
            '023446',
            '023447',
            '023448',
            '023449',
            '023450',
            '023457',
            '023460',
            '023461',
            '023468',
            '023492',
            '023493',
            '023495',
            '023511',
            '023549',
            '023575',
            '023576',
            '023593',
            '023599',
            '023605',
            '023632',
            '023645',
            '023710',
            '023716',
            '023737',
            '023757',
            '023765',
            '023774',
            '023824',
            '023828',
            '023829',
            '023867',
            '023871',
            '023875',
            '023880',
            '023886',
            '023908',
            '023920',
            '023932',
            '023955',
            '023968',
            '023977',
            '024052',
            '024053',
            '024157',
            '024188',
            '024205',
            '024207',
            '024233',
            '024234',
            '024238',
            '024284',
            '024292',
            '024344',
            '024359',
            '024665',
            '024685',
            '024804',
            '024811',
            '024861',
            '024973',
            '024997',
            '025037',
            '025058',
            '025066',
            '025076',
            '025108',
            '025116',
            '025117',
            '025122',
            '025124',
            '025137',
            '025150',
            '025206',
            '025336',
            '025342',
            '025343',
            '025384',
            '025401',
            '025479',
            '025593',
            '025743',
            '025867',
            '025925',
            '025929',
            '025950',
            '025985',
            '025986',
            '025988',
            '025998',
            '026005',
            '026010',
            '026012',
            '026028',
            '026081',
            '026115',
            '026234',
            '026269',
            '026327',
            '026336',
            '026437',
            '026438',
            '026541',
            '026572',
            '026590',
            '026773',
            '026824',
            '026825',
            '026826',
            '026831',
            '026853',
            '026943',
            '027017',
            '027034',
            '027042',
            '027088',
            '027090',
            '027152',
            '027173',
            '027179',
            '027180',
            '027218',
            '027219',
            '027294',
            '027321',
            '027432',
            '027508',
            '027542',
            '027578',
            '027580',
            '027581',
            '027591',
            '027592',
            '027593',
            '027594',
            '027617',
            '027618',
            '027656',
            '027660',
            '027684',
            '027685',
            '027710',
            '027748',
            '028101',
            '028139',
            '028243',
            '028244',
            '028373',
            '028396',
            '028447',
            '028488',
            '028543',
            '028582',
            '028635',
            '028681',
            '028700',
            '028744',
            '028752',
            '028809',
            '028811',
            '028973',
            '028977',
            '028978',
            '029025',
            '029050',
            '029211',
            '029307',
            '029453',
            '029466',
            '029467',
            '029493',
            '029567',
            '029682',
            '029703',
            '029731',
            '029838',
            '029839',
            '029960',
            '030033',
            '030131',
            '030144',
            '030221',
            '030235',
            '030254',
            '030452',
            '030460',
            '030553',
            '030555',
            '030719',
            '030729',
            '030733',
            '030734',
            '030904',
            '030933',
            '030955',
            '030986',
            '030988',
            '031096',
            '031177',
            '031180',
            '031181',
            '031182',
            '031183',
            '031184',
            '031210',
            '031227',
            '031232',
            '031235',
            '031239',
            '031240',
            '031241',
            '031242',
            '031243',
            '031264',
            '031265',
            '031267',
            '031273',
            '031279',
            '031329',
            '031352',
            '031353',
            '031354',
            '031355',
            '031410',
            '031416',
            '031550',
            '031612',
            '031629',
            '031635',
            '031643',
            '031657',
            '031756',
            '031757',
            '031877',
            '031972',
            '032008',
            '032009',
            '032056',
            '032063',
            '032077',
            '032078',
            '032141',
            '032209',
            '032218',
            '032226',
            '032245',
            '032246',
            '032438',
            '032465',
            '032481',
            '032485',
            '032486',
            '032500',
            '032529',
            '032530',
            '032571',
            '032575',
            '032596',
            '032600',
            '032641',
            '032679',
            '032690',
            '032702',
            '032733',
            '032816',
            '032827',
            '032841',
            '032854',
            '032944',
            '033019',
            '033020',
            '033026',
            '033037',
            '033055',
            '033063',
            '033097',
            '033121',
            '033126',
            '033132',
            '033148',
            '033187',
            '033188',
            '033207',
            '033219',
            '033220',
            '033222',
            '033230',
            '033255',
            '033270',
            '033312',
            '033313',
            '033397',
            '033398',
            '033399',
            '033400',
            '033401',
            '033402',
            '033417',
            '033432',
            '033433',
            '033453',
            '033476',
            '033497',
            '033503',
            '033526',
            '033541',
            '033543',
            '033549',
            '033551',
            '033573',
            '033640',
            '033641',
            '033752',
            '033814',
            '033884',
            '033916',
            '033917',
            '033969',
            '034008',
            '034021',
            '034023',
            '034048',
            '034093',
            '034095',
            '034100',
            '034124',
            '034125',
            '034190',
            '034191',
            '034203',
            '034206',
            '034207',
            '034221',
            '034255',
            '034266',
            '034277',
            '034289',
            '034375',
            '034461',
            '034500',
            '034501',
            '034535',
            '034536',
            '034546',
            '034547',
            '034558',
            '034597',
            '034613',
            '034616',
            '034624',
            '034625',
            '034626',
            '034627',
            '034637',
            '034677',
            '034678',
            '034684',
            '034705',
            '034709',
            '034722',
            '034737',
            '034739',
            '034740',
            '034741',
            '034770',
            '034776',
            '034839',
            '034840',
            '034946',
            '035035',
            '035079',
            '035155',
            '035156',
            '035183',
            '035197',
            '035210',
            '035212',
            '035221',
            '035242',
            '035253',
            '035254',
            '035257',
            '035348',
            '035349',
            '035375',
            '035396',
            '035408',
            '035435',
            '035438',
            '035488',
            '035527',
            '035544',
            '035547',
            '035562',
            '035563',
            '035568',
            '035588',
            '035603',
            '035677',
            '035678',
            '035752',
            '035754',
            '035759',
            '035761',
            '035877',
            '035908',
            '035909',
            '035911',
            '035970',
            '035973',
            '035974',
            '035995',
            '035996',
            '035997',
            '036120',
            '036131',
            '036146',
            '036171',
            '036182',
            '036272',
            '036342',
            '036393',
            '036394',
        ];

        // Jarrod This is the agent who will be assigned.
        $agent = User::find('3925');
        $this->info("We are working with ".$agent->first_name." ".$agent->last_name);

        $invoices = Invoice::whereIn('reference', $list)
            ->whereDoesntHave('note')
            ->get();

        $this->info("We have ".count($invoices)." Invoices");

        try{
            $invoices->each(function ($invoice) use($agent){

                if ($invoice->type == 'subscription'){
                    $note = new Note([
                        'type' => 'subscription_upgrade_procedure',
                        'created_at' => $invoice->created_at,
                        'updated_at' => $invoice->updated_at,
                        'description' => "CPD subscription upgraded to ".$invoice->user->subscription('cpd')->plan->name." ".$invoice->user->subscription('cpd')->plan->interval."ly",
                        'logged_by' => $agent->first_name .' '.$agent->last_name,
                        'commision_claimed' => true
                    ]);

                    $note->invoice()->associate($invoice);
                    $invoice->user->notes()->save($note);
                    $this->info("We have just fixed ".$invoice->reference. " for ".$agent->first_name.' '.$agent->last_name);

                }elseif ($invoice->type == 'event'){
                    if ($invoice->ticket){
                        $note = new Note([
                            'type' => 'event_registration',
                            'created_at' => $invoice->created_at,
                            'updated_at' => $invoice->updated_at,
                            'description' => "I have registered ".$invoice->user->first_name." ".$invoice->user->last_name." for ".$invoice->ticket->event->name." at ". $invoice->ticket->venue->name,
                            'logged_by' => $agent->first_name .' '.$agent->last_name,
                            'commision_claimed' => true
                        ]);

                        $note->invoice()->associate($invoice);
                        $invoice->user->notes()->save($note);
                        $this->info("We have just fixed ".$invoice->reference. " for ".$agent->first_name.' '.$agent->last_name);
                    }

                }elseif($invoice->type == 'store'){
                    $note = new Note([
                        'type' => 'store_items',
                        'created_at' => $invoice->created_at,
                        'updated_at' => $invoice->updated_at,
                        'description' => "Store Item purchased for ".$invoice->user->first_name." ".$invoice->user->last_name,
                        'logged_by' => $agent->first_name .' '.$agent->last_name,
                        'commision_claimed' => true
                    ]);

                    $note->invoice()->associate($invoice);
                    $invoice->user->notes()->save($note);
                    $this->info("We have just fixed ".$invoice->reference. " for ".$agent->first_name.' '.$agent->last_name);
                }

            });
        }catch (\Exception $exception){
            request($exception);
        }
    }
}

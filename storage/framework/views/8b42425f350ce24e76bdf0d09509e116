<?php $__env->startSection('title', $member->first_name . ' ' . $member->last_name); ?>
<?php $__env->startSection('description', 'User Profile'); ?>

<?php $__env->startSection('css'); ?>
    <link href="/assets/admin/vendor/bootstrap-fileinput/jasny-bootstrap.min.css" rel="stylesheet" media="screen">
    <link rel="stylesheet" type="text/css" href="/assets/admin/vendor/bootstrap-datepicker/bootstrap-datepicker.min.css">
    <style>
        .daterangepicker{
            z-index:99999!important;
        }
    </style>
<?php $__env->stopSection(); ?>

<?php $__env->startSection('content'); ?>
    <?php   
    $user_has_access = userHasAccess(auth()->user());
    ?>
    <div class="container-fluid container-fullw bg-white">
        <div class="row">
            <?php echo $__env->make('admin.members.includes.nav', array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>
            <div class="col-md-9">
                <table class="table table-striped table-hover table-bordered" id="projects">
                    <thead>
                    <tr>
                        <th>Date</th>
                        <th>Reference</th>
                        <th>Type</th>
                        <th>Terms</th>
                        <th>Total</th>
                        <th>Discount</th>
                        <th>Balance</th>
                        <th class="text-center">Status</th>
                        <th class="text-center" colspan="2">Actions</th>
                    </tr>
                    </thead>
                    <tbody>
                    <?php if(count($orders)): ?>
                        <?php foreach($orders->sortByDesc('id') as $order): ?>
                            <tr style="display: table-row;">
                                <td><?php echo e($order->created_at->toFormattedDateString()); ?></td>
                                <td>#<?php echo e($order->reference); ?></td>
                                <td><?php echo e(ucfirst($order->type)); ?></td>
                                <td class="hidden-xs text-left">
                                    <?php echo e($order->is_terms_accepted ? 'Yes' : 'No'); ?>

                                </td>
                                <td>R<?php echo e(number_format($order->total, 2)); ?></td>
                                <td>R<?php echo e(number_format($order->discount, 2)); ?></td>
                                <td>R<?php echo e(number_format($order->balance, 2)); ?></td>
                                <td class="text-center">
                                    <?php if($order->status == 'paid'): ?>
                                        <a href="" class="label label-success" data-toggle="tooltip" title="Paid" data-placement="right">
                                            <i class="fa fa-check"></i>
                                        </a>
                                    <?php else: ?>
                                        <?php if($order->status == 'unpaid'): ?>
                                            <a href=""
                                               class="label label-warning" data-toggle="tooltip" title="Unpaid" data-placement="right"> <i class="fa fa-times"></i>
                                            </a>
                                        <?php elseif($order->status == 'partial'): ?>
                                            <a href=""
                                               class="label label-warning" data-toggle="tooltip" title="Unpaid" data-placement="right"> <i class="fa fa-times"></i>
                                            </a>
                                        <?php else: ?>
                                            <a href=""
                                               class="label label-danger" data-toggle="tooltip" title="Cancelled" data-placement="right"> <i class="fa fa-ban"></i>
                                            </a>
                                        <?php endif; ?>
                                    <?php endif; ?>
                                </td>
                                <?php if($user_has_access): ?>
                                    <td>
                                    
                                        <?php if( $order->discount == 0 ): ?>    
                                        <a href="#" class="btn btn-xs btn-default" data-toggle="modal" data-target="#course_edit<?php echo e($order->id); ?>">Apply Coupon Code</a>
                                        <?php else: ?>
                                        <a href="#" class="btn btn-xs btn-default" data-toggle="modal" data-target="">Coupon Code Applied</a>
                                        <?php endif; ?>
                                        
                                        
                                        <?php echo $__env->make('admin.members.includes.coupon_event_code', array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>
                                    </td>
                                <?php endif; ?>
                                <td class="text-center">
                                    <a target="_blank" href="<?php echo e(route('order.show', $order->id)); ?>" class="btn btn-primary btn-xs">View</a>
                                    <?php if($user_has_access): ?>
                                        <?php if($order->status == 'unpaid' || $order->status == 'partial'): ?>
                                            <a href="<?php echo e(route('allocate_order_payment', $order->id)); ?>" class="btn btn-success btn-xs">Settle</a>
                                            <?php /*  <a href="#" data-target="#discount_<?php echo e($order->id); ?>" data-toggle="modal" class="btn btn-warning btn-xs">Discount</a>  */ ?>

                                            <?php echo $__env->make('admin.members.includes.discount_purchase_order', ['order' => $order], array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>
                                        <?php else: ?>
                                            <a href="#" class="btn btn-success btn-xs disabled">Settle</a>
                                            <?php /*  <a href="#" class="btn btn-warning btn-xs disabled">Discount</a>  */ ?>
                                        <?php endif; ?>
                                        <a href="<?php echo e(route('member.orders.resend', $order->id)); ?>" class="btn btn-success btn-xs">Resend</a>
                                    <?php endif; ?>

                                </td>

                                <?php if($user_has_access): ?>
                                    <td>
                                        <?php if($order->status == 'unpaid' || $order->status == 'partial'): ?>
                                            <?php echo Form::open(['method' => 'post', 'route' => ['order.cancel', $order->id]]); ?>

                                                <button class="btn btn-xs btn-danger">Cancel</button>
                                            <?php echo Form::close(); ?>

                                        <?php else: ?>
                                            <button class="btn btn-xs btn-danger disabled">Cancel</button>
                                        <?php endif; ?>
                                    </td>
                                <?php endif; ?>
                            </tr>
                        <?php endforeach; ?>
                    <?php else: ?>
                        <tr>
                            <td colspan="8">Member has no purchase orders..</td>
                        </tr>
                    <?php endif; ?>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
<?php $__env->stopSection(); ?>

<?php $__env->startSection('scripts'); ?>
    <script src="/js/app.js"></script>
    <script src="/assets/admin/assets/js/profile.js"></script>
    <script src="/assets/admin/vendor/bootstrap-fileinput/jasny-bootstrap.js"></script>
    <script src="/assets/admin/vendor/bootstrap-datepicker/bootstrap-datepicker.min.js"></script>
    <script>
        jQuery(document).ready(function () {
            Profile.init();
        });
    </script>
    <script src="/assets/admin/assets/js/bootstrap-confirm-delete.js"></script>
    <?php echo $__env->make('admin.members.includes.spin', array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>
<?php $__env->stopSection(); ?>
<?php echo $__env->make('admin.layouts.master', array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>